# 装备库浏览器功能

## 功能概览

装备库浏览器是一个全功能的装备管理和评价系统，用户可以浏览所有装备、查看评分和评论、添加到个人装备库，以及对装备进行评价和打分。

## 主要功能

### 1. 装备浏览 (`/equipment-browser`)
- **搜索功能**：支持按装备名称、品牌搜索
- **筛选功能**：按类型（跑鞋、手表等）和品牌筛选
- **排序功能**：
  - 评分从高到低/从低到高
  - 评论数最多
  - 按名称排序
  - 价格从低到高/从高到低
- **显示模式**：网格视图和列表视图
- **快速操作**：
  - 添加到我的装备库
  - 查看装备详情

### 2. 装备详情页 (`/equipment/[id]`)
- **装备信息**：名称、品牌、分类、价格、描述
- **评分统计**：
  - 平均评分（星级显示）
  - 评论总数
  - 评分分布图表
- **用户评价**：
  - 查看所有用户评价
  - 按时间/评分排序
  - 显示评价详情（优点、缺点、使用时长）
- **个人操作**：
  - 添加到我的装备库
  - 写评价/编辑我的评价
  - 删除我的评价

### 3. 评价系统
- **评分**：1-5星评分系统
- **评价内容**：
  - 评论标题（可选）
  - 详细评论（可选）
  - 优点描述（可选）
  - 缺点描述（可选）
  - 使用时长（月份）
- **评价管理**：用户可以编辑或删除自己的评价

## 数据库设计

### 核心表结构

#### equipment_reviews（评论表）
```sql
- id: UUID 主键
- user_id: 用户ID
- sku_id: 装备SKU ID
- rating: 评分(1-5)
- review_title: 评论标题
- review_content: 详细评论
- pros: 优点
- cons: 缺点  
- usage_duration: 使用时长（月）
- created_at/updated_at: 时间戳
- UNIQUE(user_id, sku_id): 每用户每装备只能评价一次
```

#### equipment_ratings（评分汇总表）
```sql
- sku_id: 装备SKU ID（主键）
- average_rating: 平均评分
- review_count: 评论数量
- rating_distribution: 评分分布JSON
- updated_at: 更新时间
```

### 关键特性

1. **自动统计更新**：使用数据库触发器自动更新评分统计
2. **RLS安全策略**：用户只能修改自己的评论
3. **性能优化**：独立的评分汇总表避免实时计算
4. **数据完整性**：外键约束和检查约束确保数据质量

## 文件结构

```
src/
├── app/
│   ├── equipment-browser/
│   │   └── page.tsx                    # 装备浏览器主页
│   └── equipment/[id]/
│       ├── page.tsx                    # 装备详情页（服务端）
│       └── EquipmentDetailClient.tsx   # 装备详情客户端组件
├── components/
│   └── equipment/
│       └── EquipmentReviewModal.tsx    # 评价模态框组件
└── database-migration.sql             # 数据库迁移脚本
```

## 安装和配置

### 1. 数据库设置
在 Supabase Dashboard 的 SQL 编辑器中运行 `database-migration.sql` 脚本来创建必要的表和触发器。

### 2. 环境变量
确保设置了以下环境变量：
```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 3. 路由配置
装备库浏览器已经添加到导航菜单中，用户可以通过头部导航访问。

## 用户使用流程

### 浏览装备
1. 访问 `/equipment-browser` 
2. 使用搜索框或筛选器查找感兴趣的装备
3. 选择排序方式和显示模式
4. 点击"查看详情"了解装备详细信息

### 添加装备到个人库
1. 在装备浏览器或详情页点击"添加到我的装备"
2. 装备将自动添加到用户的个人装备库中

### 评价装备
1. 在装备详情页点击"写评价"按钮（需登录）
2. 填写评分（必需）和其他可选信息
3. 提交评价后会自动更新装备的评分统计

### 管理个人评价
1. 用户可以在装备详情页看到自己的评价
2. 点击编辑按钮修改评价内容
3. 点击删除按钮移除评价

## 技术特点

### 前端特性
- **响应式设计**：支持移动端和桌面端
- **实时搜索**：输入即时搜索结果
- **模态框交互**：流畅的评价编辑体验
- **星级评分组件**：直观的评分显示和交互

### 后端特性
- **数据库触发器**：自动维护评分统计
- **RLS安全**：行级安全策略保护用户数据
- **性能优化**：汇总表减少复杂查询
- **数据完整性**：约束确保数据质量

### 用户体验
- **无需刷新**：AJAX操作，流畅体验
- **即时反馈**：操作成功/失败提示
- **防重复评价**：数据库约束防止重复
- **评价排序**：多种排序方式满足不同需求

## 扩展可能性

1. **图片上传**：为装备和评价添加图片
2. **评价点赞**：用户可以对有用的评价点赞
3. **标签系统**：为装备添加标签分类
4. **推荐算法**：基于用户评价推荐装备
5. **社区功能**：用户关注和装备讨论
6. **数据分析**：装备流行度和用户偏好分析

## 维护说明

### 定期任务
- 监控评分统计数据的准确性
- 清理无效或垃圾评价
- 备份用户评价数据

### 性能优化
- 定期分析查询性能
- 考虑添加更多索引
- 监控数据库负载

### 安全考虑
- 定期审查RLS策略
- 监控异常操作行为
- 保护用户隐私数据